<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>AirPods</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="static/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="static/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="static/css/media.css"/>
</head>

<body>
<!-- 菜单导航部分 -->
<div class="nav">
<div class="nav-right">
		<a href="javascript:void(0)" class="wallet"></a>
		<a href="index.html" class="logo"></a>
	</div>
    <a href="index.html" class="text">InstantPods</a>
    <a href="index.html?#works" class="text">How it works?</a>
    <a href="faq.html" class="text">FAQs</a>
    <a href="index.html?#contact" class="text">Shipping & Delivery</a>
    <a href="index.html?#contact" class="text">After Repair</a>
    <a href="index.html?#contact" class="text">Local Customer</a>
    <a href="index.html?#contact" class="text">Contact US</a>
    <input hidden="hidden" type="checkbox" name="choose" id="choose" value=""/>
    <label for="choose" class="toggle-btn">
        <span class="line"></span>
        <span class="line"></span>
    </label>
    <!-- 菜单导航中，隐藏的变成移动端后才显示的菜单 -->
 <div class="nav-content">
        <div class="nav-page">
            <div class="search-input">
                <div class="icon" id="search-btn"></div>
                <input type="text" name="searchName" id="searchName" placeholder="search name"/>
                <span class="search-close">Cancel</span>
            </div>
            <hr/>
            <div class="nav-list search-list">
                <h4 style="margin-top: 12px;font-size: 18px;">Quick Links</h4>
                <a href="javascript:void(0)" class="nav-text search-result">No Found</a>
                <a style="border-bottom: 1px solid #333;" href="javascript:void(0)" class="nav-text search-faq-result">No Found</a>
            </div>
            <div class="nav-list nav-box">
                <a href="index.html" class="nav-text">InstantPods</a>
                <a href="index.html?#works" class="nav-text">How it works?</a>
                <a href="faq.html" class="nav-text">FAQs</a>
                <a href="index.html?#contact" class="nav-text">Shipping & Delivery</a>
                <a href="index.html?#contact" class="nav-text">After Repair</a>
                <a href="index.html?#contact" class="nav-text">Local Customer</a>
                <a href="index.html?#contact" class="nav-text">Contact US</a>
            </div>
        </div>
    </div>
</div>
<section class="section" style="height: auto;">
    <div class="section-content">
        <!-- 序列号-->
        <input hidden="hidden" type="text" name="code" id="code" value=""/>
        <!-- 问题大类-->
        <input hidden="hidden" type="text" name="desc" id="desc" value=""/>
        <!-- 问题小类-->
        <input hidden="hidden" type="text" name="subCategory" id="subCategory" value=""/>
        <!-- 问题小类-->
        <input hidden="hidden" type="text" name="back" id="back" value=""/>
        <!-- 问题类型-->
        <input hidden="hidden" type="text" name="type" id="type" value=""/>
        <!-- 耳机类别-->
        <input hidden="hidden" type="text" name="category" id="category" value=""/>
        <!-- 问题级别-->
        <input hidden="hidden" type="text" name="level" id="level" value=""/>
        <!-- 问题类型-->
        <h3 class="serial-title happen-box">What’s happening with <br> your AirPods?</h3>
        <p class="serial-product">Your Product: <span id="yourProduct">AirPods, 2nd Gen</span></p>
        <div class="choose-box">
            <div class="choose-left">
                <img class="section-img" src="static/images/page/promo-icon5.png" alt="promo5">
            </div>
            <div class="choose-right">
                <div class="top">Choose your replacement.</div>
                <ul class="choose-list"></ul>
                <div class="text">
                    <div class="desc">Do you want to Trade In your bad
                        AirPod for credit?</div>
                    <a class="trade see-trade-btn" data-method="offset" data-type="auto"
                       data-title="How does InstantPods Trade In Works?" href="javascript: void(0);">See how trade-in works</a>
                </div>
                <div class="question-charge-lower">
                    <span class="question-charge question-charge-yes yes-bg" data-type="yes">YES</span>
                    <span class="question-charge question-charge-no"  data-type="no">NO</span>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="static/js/jquery.min.js" type="application/javascript"></script>
<script src="static/js/search.js" type="application/javascript"></script>
<script src="static/layui/layui.js" type="application/javascript"></script>
<script>
    $(function () {
        var codeValue = localStorage.getItem("sn");
		var chooseData = JSON.parse(localStorage.getItem("chooseData"));
        $("#code").val(codeValue);
        var subCode = codeValue.substr(-4);
        if (subCode == 'H8TT') {
            $("#yourProduct").text('AirPods, 1st Gen');
        } else if (subCode == 'LX2Y') {
            $("#yourProduct").text('AirPods, 2nd Gen');
        } else if (subCode == 'JMMT') {
            $("#yourProduct").text('AirPods, 2nd Gen');
        } else {
            $("#yourProduct").text('AirPods Pro');
        }
		let chooseListStr = '';
		let chooseArr = chooseData.goods;
		for (var i = 0; i< chooseArr.length; i++) {
		    chooseListStr += '<li data-id="' + chooseArr[i].id + '" data-name="' + chooseArr[i].name + '" data-price="' + chooseArr[i].price + '">\n' +
		        '                <span>' + chooseArr[i].name + '</span><span>' + chooseArr[i].price + '</span>\n' +
		        '            </li>'
		}
		$('.choose-list').html(chooseListStr);
    })
    var active = {
        offset: function (othis) {
            var type = othis.data('type');
            var title = othis.data('title');
            var text = '<div class="choose-faq">\n' +
                '<h5>1. See what your faulty AirPod is worth</h5>\n' +
                '<p>When you order the replacement AirPods, answer a few questions to get your estimated trade-in value.</p>\n' +
                '<h5>2. Ship your faulty AirPods to us within 14 days.</h5>\n' +
                '<p>After your replacements arrives, use the included return label and packaging to send back your bad AirPods to us within 14 days.</p>\n' +
                '<h5>3. Get refund credited to your original method of payment.</h5>\n' +
                '<p>Once we receive your bad AirPods, we will inspect and verify its condition. If everything checks out, your trade in is complete and we will credit your original payment method. If your returned AirPods does not match the condition you described, you’ll receive an email with next steps.</p>\n' +
                '<h5>What if the AirPods I returned does not match the condition I described or it was confirmed counterfeit?</h5>\n' +
                '<p>If the condition of your AirPods doesn’t match what you described, a new estimated trade-in value will be provided. You’ll have the option to either accept this revised quote or reject it. If you reject it, your device will be returned to you at a flat rate shipping fee.</p>\n' +
                '</div>';
            var indexLayer = layer.open({
                type: 1
                , title: title
                , maxWidth: 650
                , offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                , id: 'layerDemo' + type //防止重复弹出
                , content: '<div style="padding: 20px 10px 30px;">' + text + '</div>'
                , btnAlign: 'c' //按钮居中
                , shade: 0 //不显示遮罩
                , yes: function () {
                    layer.closeAll();
                }
            });
            if((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
                layer.full(indexLayer)
            }
        }
    }
    $('.see-trade-btn').on('click', function () {
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
	var selectId = ''
	$(document).delegate('.choose-list li', 'click', function (event) {
        var that = $(this), id = that.data('id'), name = that.data('name'), price = that.data('price');
		var shop = {
			id: id,
			name: name,
			price: price
		};
		selectId = id;
        that.addClass('active');
        that.siblings().removeClass('active');
        localStorage.setItem("chooseShop", JSON.stringify(shop));
		event.preventDefault();
		event.stopPropagation();
    })
	$(document).delegate('.question-charge', 'click', function (event) {
		var that = $(this), type = that.data('type');
		if(selectId === '') {
			layer.msg('Please Choose your replacement.');
			return false;
		}
		var params = {
		    id: selectId,
			whether: type,
		}
		$.ajax({
		    type: "POST",
		    url: "/api/order/getOrder",
		    data: params,
		    dataType: "json",
		    success: function (data) {
		       if(type === 'yes') {
		       	window.location.href= 'happening.html';
		       } else {
		       	window.location.href= 'check.html';
		       }
		       window.event.returnValue=false;
		       event.preventDefault();
		       event.stopPropagation();
		    },
		    error: function (data) {
		        layer.msg('Submission Failed');
				console.log(type)
				if(type+ '' === 'yes') {
					window.location.href= 'happening.html';
				} else {
					var orderData = {
					    "total": '24.00',
					    "goods": [{
					        "name": "Replacement, Charging Case, 2nd Gen",
					        "sku": "1GLRFB",
					        "price": "$59.99"
					    }, {
					        "name": "*Trade in: Charging Case, AirPods 2nd Gen",
					        "sku": "1GLT2",
					        "price": "-$30.00"
					    }],
					    "shipping": "5.50",
					    "tax": "0.00"
					};
					localStorage.setItem("orderData", JSON.stringify(orderData));
					window.location.href= 'check.html';
				}
				window.event.returnValue=false;
				event.preventDefault();
				event.stopPropagation();
		    }
		});
	})
</script>

</body>

</html>
